<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ“ŠIssue Report Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* Same styles as before */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: #f0f2f5;
      color: #333;
    }
    header {
      background: #1f2937;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 24px;
    }
    .top-actions {
      text-align: center;
      margin: 20px 0;
    }
    .top-actions button {
      padding: 10px 20px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .container {
      display: flex;
      gap: 20px;
      padding: 20px;
      flex-wrap: wrap;
    }
    .left-panel {
      flex: 2;
      min-width: 350px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .right-panel {
      flex: 1.3;
      min-width: 300px;
      max-height: 90vh;
      overflow-y: auto;
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }
    .chart-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }
    h3 {
      margin: 0 0 10px;
      font-size: 18px;
    }
    canvas {
      width: 100% !important;
      height: 320px !important;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #e0e0e0;
    }
    th {
      background: #374151;
      color: white;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    @media (max-width: 900px) {
      .container { flex-direction: column; }
    }
  </style>
</head>
<body>

<header>ðŸ“ŠIssue Tracking Dashboard</header>

<div class="top-actions">
  <button onclick="exportToPDF()">ðŸ–¨ Export to PDF</button>
</div>

<div class="container" id="reportContent">
  <div class="left-panel">
    <div class="chart-card">
      <h3>ðŸ“ˆ All Status Overview</h3>
      <canvas id="mainChart"></canvas>
    </div>
    <div class="chart-card">
      <h3>ðŸ“Š New vs Closed Trend</h3>
      <canvas id="zoomedChart"></canvas>
    </div>
  </div>

  <div class="right-panel">
    <h3>ðŸ“… Daily Issue Table</h3>
    <table id="issueTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>New</th>
          <th>Open</th>
          <th>Closed</th>
          <th>Severe</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
const issueData = [
  { date: "5-Jun-25", new:10, open:8, closed:2, severe:2 },
  { date: "6-Jun-25", new:'-', open:'-', closed:'-', severe: '-' },
  { date: "7-Jun-25", new:'-', open:'-', closed:'-', severe:'-' },
  { date: "8-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "9-Jun-25", new: 9, open: 9, closed: 2, severe:4},
  { date: "10-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "11-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "12-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "13-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "14-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "15-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "16-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "17-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "18-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "19-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "20-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "21-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "22-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "23-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "24-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "25-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "26-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "27-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "28-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "29-Jun-25", new: '-', open: '-', closed: '-', severe: '-' },
  { date: "30-Jun-25", new: '-', open: '-', closed: '-', severe: '-' }
];

const tbody = document.querySelector('#issueTable tbody');
issueData.forEach(row => {
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${row.date}</td><td>${row.new}</td><td>${row.open}</td><td>${row.closed}</td><td>${row.severe}</td>`;
  tbody.appendChild(tr);
});

const labels = issueData.map(d => d.date);
const numericOrZero = val => typeof val === 'number' ? val : 0;
const dataNew = issueData.map(d => numericOrZero(d.new));
const dataOpen = issueData.map(d => numericOrZero(d.open));
const dataClosed = issueData.map(d => numericOrZero(d.closed));
const dataSevere = issueData.map(d => numericOrZero(d.severe));

new Chart(document.getElementById('mainChart'), {
  type: 'line',
  data: {
    labels,
    datasets: [
      { label: 'New', data: dataNew, borderColor: '#f59e0b', tension: 0.3, fill: false },
      { label: 'Open', data: dataOpen, borderColor: '#ef4444', tension: 0.3, fill: false },
      { label: 'Closed', data: dataClosed, borderColor: '#10b981', tension: 0.3, fill: false },
      { label: 'Severe', data: dataSevere, borderColor: '#8b5cf6', borderDash: [6, 4], tension: 0.3, fill: false }
    ]
  },
  options: {
    plugins: {
      title: {
        display: true,
        text: 'Issues by Status'
      }
    }
  }
});

new Chart(document.getElementById('zoomedChart'), {
  type: 'bar',
  data: {
    labels,
    datasets: [
      { label: 'New', data: dataNew, backgroundColor: '#fbbf24' },
      { label: 'Closed', data: dataClosed, backgroundColor: '#4ade80' }
    ]
  },
  options: {
    plugins: {
      title: {
        display: true,
        text: 'New vs Closed Issues'
      }
    }
  }
});

async function exportToPDF() {
  const dashboard = document.getElementById("reportContent");
  const canvas = await html2canvas(dashboard, { backgroundColor: "#ffffff" });

  const imgData = canvas.toDataURL("image/png");
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("landscape", "pt", "a4");

  const pageWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();

  const imgProps = pdf.getImageProperties(imgData);
  const ratio = Math.min(pageWidth / imgProps.width, pageHeight / imgProps.height);

  const imgWidth = imgProps.width * ratio;
  const imgHeight = imgProps.height * ratio;

  const x = (pageWidth - imgWidth) / 2;
  const y = 20;

  pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
  pdf.save("issue_report.pdf");
}
</script>

</body>
</html>
